<markdown-viewer>
  <div class="card { post.content ? '' : 'hide' }">
    <div class="card-title center { post.title ? '' : 'hide' }">
      <p>&nbsp;</p>
      { post.title }
    </div>
    <div id="viewer-content" class="card-content">
    </div>
  </div>

  <script>
      var tag = this;
      Manuscript.tags['viewer'] = tag;

      tag.postId = null;
      tag.post = {
        title: "",
        content: ""
      };

      tag.on('update', function (e={}) {
        if(e.post) {
          tag.post = e.post;
          return;
        }
        postId = e.postId || tag.postId;

        if(!postId) {
          // If no post id, set post to an error
          tag.post = {
            'title': "",
            'content': "# An unknown error has occurred"
          };
        } else {
          // retrieve post
          tag.post = Manuscript.db.findOne({
            _id: postId
          });
        }

        // render markdown
        $('#viewer-content').html(marked(tag.post.content));
      });

      tag.on('mount', function () {
          console.log('markdown-viewer mounted!')
      });
  </script>
</markdown-viewer>
