<markdown-editor>
  <style>
    /* Offset SimpleMDE CodeMirror stuff for sidebar */
    .editor-toolbar.fullscreen,
    .CodeMirror-fullscreen {
      left: 6em;
    }
  </style>
  <div class="card">
    <p>&nbsp;</p>
    <div class="card-title center">
      <input type="text" style="width: 70%; text-align: center" ref="title" placeholder="Title" value="{ post.title }">
      <!--<p>Date: <input type="text" id="datepicker"></p>-->
    </div>
    <div class="card-content">
      <textarea id="editor"></textarea>

      <a class="waves-effect waves-light btn materialize-red"><i class="material-icons right">cancel</i>Cancel</a>
      <a class="waves-effect waves-light btn green right" onclick="{ save }"><i class="material-icons right">save</i>{ postId ? 'Save' : 'Create' }</a>
    </div>
  </div>

  <script>
      var tag = this;
      Manuscript.tags['editor'] = tag;
      tag.post = {
        'title': "",
        'content': ""
      };
      tag.postId = null;

      tag.on('mount', function () {
          tag.simplemde = new SimpleMDE({
              element: document.getElementById('editor'),
              toolbar: [
                  'bold', 'italic', 'heading', '|',
                  'quote', 'unordered-list', 'ordered-list', '|',
                  'link', 'image', '|',
                  'preview', 'side-by-side', 'fullscreen', '|',
                  'guide',
                  {
                    name: 'save',
                    action: tag.save,
                    className: 'fa fa-floppy-o',
                    title: 'Save'
                  },
              ]
          });
          console.log('markdown-editor mounted!', tag)
      });

      tag.on('update', function (e) {
        console.log('markdown-editor update', tag);
        // Get post based on ID
        postId = e && e.postId ? e.postId : tag.postId;

        // retrieve post or set to empty values
        tag.post = Manuscript.db.findOne({ _id: postId }) || { 'title': "", 'content': "" };

        tag.simplemde.value(tag.post.content);
      });

      tag.save = () => {
        tag.post.title = tag.getTitle();
        tag.post.content = tag.getContent();
        var obj = Manuscript.db.savePost(tag.post, tag.postId);

        Manuscript.info("Post saved successfully!", obj);

        if(!tag.postId && obj && obj._id) {
          tag.postId = obj._id;
        }
      };

      tag.getContent = () => {
        return tag.simplemde.value();
      };

      tag.getTitle = function () {
        return tag.refs.title.value
      };
  </script>
</markdown-editor>
